{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="{% static 'img/favicon.ico' %}" type="image/x-icon">
  <link rel="stylesheet" href="{% static 'css/base_1.css' %}">
  <script src="{% static 'js/base.js' %}"></script>
  <title>
    PassAccess | 
    {% block title %}
      <!-- inheritance -->
    {% endblock title %}
  </title>
</head>
<body>
  {% if monitor_session_age == True and request.user.monitor_session_age == True %}
    <!-- thes two span tags won`t be visible (they are hidden in the base_1.css file). The first one will count number of seconds of in active, while the second one is the logged in user session age value -->
    <span class="security_secs"></span>
    <span class="security_user_sess_age">{{request.user.session_age}}</span>
  {% endif %}
  
  <div class="container">
    <div class="nav_panel">
      <form class="search_form">
        <input type="search" name="" placeholder="Search here">
        <button type="submit">search</button>
        <img src="{% static 'img/hide_menu.png' %}" id="hide_menu_t" alt="" onclick="hideMenu()">
      </form>

      <div class="side">
        <div class="category">
          <h1>Category</h1>
          <p><a href="{% url 'secureapp:landing' %}">Dashboard</a></P>
            <p><a href="{% url 'secureapp:new_item' %}">New item</a></P>
            <p><a href="{% url 'secureapp:set_passcode' %}">Set secure</a></P>
            <p><a href="{% url 'secureapp:update_passcode' %}">Update secure</a></P>
          {% if request.user.passcode.passcode_ingredient == None or request.user.passcode.passcode_ingredient == '' %}
            <p><a href="{% url 'secureapp:set_passcode' %}">Finish setting passcode</a></P>
          {% endif %}
        </div>
        <br>

        {% block item %}
            <!-- items -->
        {% endblock item %}
        <br>
        <div class="category">
          <h1>Auth</h1>
          <p><a href="#">Secure Notes</a> <span>4</span></P>
          <p><a href="#">Trusted memberships</a><span>3</span></P>
          <p><a href="#">Trusted people</a><span>7</span></P>
          <p><a href="#">Contact Us</a></P>
          <p><a href="#">About</a></P>

          {% if request.user.is_authenticated %}
            <p><a href="admin">Admin</a></P>
            <p><a href="{% url 'auth:update_profile' %}">Update profile</a></P>
              <p><a href="{% url 'auth:password_generator' %}">Password generator</a></P>
                <p><a href="{% url 'auth:change_password' %}">Change password</a></P>
            <p><a href="{% url 'auth:logout' %}">Logout</a></P>
          {% else %}
            <p><a href="{% url 'auth:login' %}">Login</a></P>
            <p><a href="{% url 'auth:signup' %}">Sign Up</a></P>
          {% endif %}
        </div>
        <br>

        <div class="category">
          <h1>Trusted access</h1>
          <p><a href="#">Hamza Musa</a></P>
          <p><a href="#">Aliyu Samaila</a></P>
        </div>
        <br>

        <div class="foot">
          <small>Get 
            <a href="#">help</a> from PassAccess community or start live <a href="#">chat</a> with our people
          </small>
          <p>2022 - {{the_year}}</p>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="header">
        <div class="l_header">
          <img src="{% static 'img/show_menu.png' %}" id="show_menu" alt="" onclick="showMenu()">
          <img src="{% static 'img/show_menu.png' %}" id="hide_menu" alt="" onclick="hideMenu()">
          <a href="{% url 'secureapp:landing' %}"><h1>PassAccess</h1></a>
        </div>

        <div class="r_header">
          <span>{{request.user.first_name|slice:':1'|upper}}{{request.user.last_name|slice:':1'|upper}}</span>
          <a href="#">{{request.user.first_name}} {{request.user.last_name}}</a>
          <a>|</a>
          <a href="#">Notification</a>
        </div>
      </div>

      <div class="main_inn">
        {% if messages %}
          {% for flash_msg in messages %}
            <div class="box">
              <div class="box_inn">
                <br>
                <div class="alert_{{flash_msg.tags}}">
                  <p class="alert_col_{{flash_msg.tags}}">{{flash_msg}}</p>
                </div>
                <br>
              </div>
            </div>
          {% endfor %}
        {% endif %}

        {% block main %}
          <!-- inheritance -->
        {% endblock main %}
      </div>
    </div>

  </div>
  <script type="text/javascript">
		let timer = 0;
		let currSeconds = 0;
    let secsCount = document.querySelector('.security_secs').textContent;
    let userSessionAge = document.querySelector('.security_user_sess_age').textContent;
    
		function resetTimer() {
			// Hide the timer text
			document.querySelector('body').style.display = 'block';
      document.querySelector('html').style.background = 'white';
			// Clear the previous interval
			clearInterval(timer);
			// Reset the seconds of the timer
			currSeconds = 0;
			// Set a new interval
      // NOTE: 1 second = 1000 milliseconds
			timer = setInterval(startIdleTimer, 1000);
		}
    
		// events that would reset the timer
		window.onload = resetTimer;
		window.onmousemove = resetTimer;
		window.onmousedown = resetTimer;
		window.ontouchstart = resetTimer;
		window.onclick = resetTimer;
		window.onkeypress = resetTimer;
    
		function startIdleTimer() {
			// Increment the timer seconds
			currSeconds++;
      // if (secsCount == userSessionAge / 2 || secsCount === userSessionAge / 2){
      if (secsCount == 30 || secsCount === 30){
        document.querySelector('body').style.display = 'none';
        document.querySelector('html').style.background = 'rgb(3, 3, 45)';
      }
			// Set the timer text to the new value
			secsCount = currSeconds;
		}
	</script>
</body>
</html>
